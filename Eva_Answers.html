<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eva Answers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/annyang@2.6.1/dist/annyang.min.js"></script>
  <script>
    function greetUser() {
      const name = document.getElementById('username').value || "Explorer";
      const greeting = `Hello, ${name}! Ready to journey with Eva?`;
      document.getElementById('greeting').innerText = greeting;
    }

    function playSound() {
      const audio = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_44a82cfa2d.mp3?filename=notification-113218.mp3");
      audio.play().catch(err => console.error("Audio play error:", err));
    }

    async function sendToN8n() {
      const payload = {
        name: document.getElementById('username').value,
        interests: Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.parentElement.innerText.trim()),
        assets: document.querySelector('input[placeholder="e.g. XRP,SOL"]').value,
        sources: document.querySelector('input[placeholder="https://news.ycombinator.com/rss"]').value
      };

      try {
        await fetch("https://n8n.45dgof8.com/webhook/test-input", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        await fetch("https://hooks.zapier.com/hooks/catch/123456/abcde", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        document.getElementById("feedback").innerText = "‚úÖ Settings transmitted successfully!";
        document.getElementById("feedback").classList.remove("hidden");
      } catch (error) {
        console.error("Submission failed:", error);
        document.getElementById("feedback").innerText = "‚ö†Ô∏è Failed to transmit settings.";
        document.getElementById("feedback").classList.remove("hidden");
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (typeof annyang !== "undefined" && annyang) {
        const commands = {
          'hello': () => greetUser(),
          'export': () => sendToN8n(),
          'sound': () => playSound(),
          'my name is *name': name => {
            document.getElementById('username').value = name;
            greetUser();
          }
        };
        annyang.addCommands(commands);
        annyang.start();
      } else {
        document.getElementById("voiceFallback").classList.remove("hidden");
      }
    });
  </script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white font-sans min-h-screen p-8 animate-fadeIn">
  <div class="max-w-3xl mx-auto bg-gray-800 p-6 rounded-2xl shadow-2xl">
    <div class="flex justify-between items-center mb-4">
      <a href="https://45dgof8.com" class="text-purple-400 hover:underline">Go to My Blog</a>
      <button class="bg-purple-600 text-white px-4 py-1 rounded hover:bg-purple-500">Customize Eva</button>
    </div>

    <h1 class="text-3xl font-bold mb-2 text-center">Welcome to Eva's Answer Hub üåå</h1>
    <p id="greeting" class="text-center text-lg mb-6 italic text-purple-300">Greetings, Space Traveller...</p>

    <div id="voiceFallback" class="hidden bg-yellow-100 text-yellow-900 p-4 rounded mb-4">
      ‚ö†Ô∏è Voice commands aren't supported in your browser. Use the buttons below instead!
      <div class="flex space-x-2 mt-2">
        <button onclick="greetUser()" class="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-1 rounded">Hello</button>
        <button onclick="sendToN8n()" class="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-1 rounded">Export</button>
        <button onclick="playSound()" class="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-1 rounded">Sound</button>
      </div>
    </div>

    <div class="flex justify-center mb-6">
      <iframe src="https://app.readyplayer.me/avatar?frameApi" allow="camera *; microphone *" class="w-64 h-96 rounded-xl shadow-lg border-4 border-purple-700"></iframe>
    </div>

    <label class="block mb-2">Your Name:</label>
    <input id="username" type="text" oninput="greetUser()" class="w-full p-2 mb-4 rounded bg-gray-700 border border-gray-600" />

    <label class="block mb-2">Select Your Interests:</label>
    <div class="grid grid-cols-2 gap-2 mb-4">
      <label class="flex items-center"><input type="checkbox" value="Crypto" class="mr-2"> Crypto</label>
      <label class="flex items-center"><input type="checkbox" value="Science" class="mr-2"> Science</label>
      <label class="flex items-center"><input type="checkbox" value="News" class="mr-2"> News</label>
      <label class="flex items-center"><input type="checkbox" value="Art" class="mr-2"> Art</label>
      <label class="flex items-center"><input type="checkbox" value="Tech" class="mr-2"> Tech</label>
    </div>

    <label class="block mb-2">Followed Assets:</label>
    <input type="text" placeholder="e.g. XRP,SOL" class="w-full p-2 mb-4 rounded bg-gray-700 border border-gray-600" />

    <label class="block mb-2">News Sources:</label>
    <input type="text" placeholder="https://news.ycombinator.com/rss" class="w-full p-2 mb-4 rounded bg-gray-700 border border-gray-600" />

    <div class="mb-4">
      <label class="block mb-2">Upload Preferences:</label>
      <input type="file" class="w-full bg-gray-700 p-2 rounded" />
    </div>

    <div class="text-center mt-6 space-x-4">
      <button onclick="sendToN8n()" class="bg-green-500 hover:bg-green-400 text-black font-semibold px-6 py-2 rounded-xl shadow-md">Export Settings</button>
      <button onclick="playSound()" class="bg-blue-500 hover:bg-blue-400 text-white font-semibold px-4 py-2 rounded-xl shadow-md">üîä Sound Test</button>
    </div>

    <div id="feedback" class="text-center mt-4 text-green-400 hidden"></div>
  </div>

  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 1.2s ease-out;
    }
  </style>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const savedTheme = localStorage.getItem("evaTheme");
    if (savedTheme) {
      document.body.className = savedTheme;
      document.getElementById("theme").value = savedTheme;
    }

    let name = localStorage.getItem("evaName");
    if (!name) {
      name = prompt("Welcome! What's your name?");
      if (name) localStorage.setItem("evaName", name);
    }

    const welcomeBack = localStorage.getItem("evaVisited");
    const hour = new Date().getHours();
    let greeting = hour < 12 ? "‚òÄÔ∏è Good morning" : hour < 18 ? "üåû Good afternoon" : "üåô Good evening";

    if (welcomeBack && name) {
      document.getElementById("welcomeMessage").textContent = `${greeting}, ${name}! Welcome back ‚ú®`;
    } else if (name) {
      document.getElementById("welcomeMessage").textContent = `üëã Welcome, ${name}! Ready to explore?`;
      localStorage.setItem("evaVisited", true);
    }

    // Save personalization settings
    const inputs = document.querySelectorAll(".settings input, .settings select");
    inputs.forEach(input => {
      const key = "eva_" + input.placeholder.replace(/[^a-z]/gi, '').toLowerCase();
      if (localStorage.getItem(key)) input.value = localStorage.getItem(key);
      input.addEventListener("change", () => localStorage.setItem(key, input.value));
    });

    // Export Settings
    const exportBtn = document.createElement("button");
    exportBtn.textContent = "üì§ Export Settings";
    exportBtn.className = "feature-button";
    exportBtn.onclick = function () {
      const lines = [];
      inputs.forEach(input => {
        const label = input.previousElementSibling ? input.previousElementSibling.textContent.split(':')[0].toLowerCase() : "";
        lines.push(`${label}=${input.value}`);
      });
      const blob = new Blob([lines.join("\n")], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'eva_settings.txt';
      a.click();
      URL.revokeObjectURL(url);
    };
    document.querySelector(".settings").appendChild(exportBtn);

    // Import Settings
    const importBtn = document.createElement("button");
    importBtn.textContent = "üì• Import Settings";
    importBtn.className = "feature-button";
    const fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.accept = ".txt";
    fileInput.style.display = "none";
    importBtn.onclick = () => fileInput.click();
    fileInput.onchange = function () {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function () {
        const lines = reader.result.split("\n");
        lines.forEach(line => {
          const [key, value] = line.split("=");
          const input = Array.from(inputs).find(i => i.previousElementSibling && i.previousElementSibling.textContent.toLowerCase().includes(key));
          if (input) {
            input.value = value;
            localStorage.setItem("eva_" + key, value);
          }
        });
      };
      reader.readAsText(file);
    };
    document.querySelector(".settings").appendChild(importBtn);
    document.querySelector(".settings").appendChild(fileInput);
  });

  function switchTheme(theme) {
    document.body.className = theme;
    localStorage.setItem("evaTheme", theme);
  }
    // Entire HTML document remains unchanged, except for updated script

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const urlParams = new URLSearchParams(window.location.search);
    const nameFromURL = urlParams.get("name");
    const profileFromURL = urlParams.get("profile");

    const savedTheme = localStorage.getItem("evaTheme");
    if (savedTheme) {
      document.body.className = savedTheme;
      document.getElementById("theme").value = savedTheme;
    }

    let name = nameFromURL || localStorage.getItem("evaName");
    if (!name) {
      name = prompt("Welcome! What's your name?");
      if (name) localStorage.setItem("evaName", name);
    } else if (!localStorage.getItem("evaName")) {
      localStorage.setItem("evaName", name);
    }

    let profile = profileFromURL || localStorage.getItem("evaProfile") || "default";
    if (profileFromURL && profileFromURL !== localStorage.getItem("evaProfile")) {
      localStorage.setItem("evaProfile", profileFromURL);
    }

    const welcomeBack = localStorage.getItem("evaVisited");
    const hour = new Date().getHours();
    let greeting = hour < 12 ? "‚òÄÔ∏è Good morning" : hour < 18 ? "üåû Good afternoon" : "üåô Good evening";

    if (welcomeBack && name) {
      document.getElementById("welcomeMessage").textContent = `${greeting}, ${name}! Welcome back ‚ú®`;
    } else if (name) {
      document.getElementById("welcomeMessage").textContent = `üëã Welcome, ${name}! Ready to explore?`;
      localStorage.setItem("evaVisited", true);
    }

    const inputs = document.querySelectorAll(".settings input, .settings select");
    inputs.forEach(input => {
      const key = `eva_${profile}_` + input.placeholder.replace(/[^a-z]/gi, '').toLowerCase();
      if (localStorage.getItem(key)) input.value = localStorage.getItem(key);
      input.addEventListener("change", () => localStorage.setItem(key, input.value));
    });

    const timestamp = () => new Date().toISOString().replace(/[:.]/g, '-');

    const exportBtn = document.createElement("button");
    exportBtn.textContent = "üì§ Export Settings";
    exportBtn.className = "feature-button";
    exportBtn.onclick = function () {
      const lines = [];
      inputs.forEach(input => {
        const label = input.previousElementSibling ? input.previousElementSibling.textContent.split(':')[0].toLowerCase() : "";
        lines.push(`${label}=${input.value}`);
      });
      const blob = new Blob([lines.join("\n")], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `eva_${profile}_${timestamp()}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    };
    document.querySelector(".settings").appendChild(exportBtn);

    const importBtn = document.createElement("button");
    importBtn.textContent = "üì• Import Settings";
    importBtn.className = "feature-button";
    const fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.accept = ".txt";
    fileInput.style.display = "none";
    importBtn.onclick = () => fileInput.click();
    fileInput.onchange = function () {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function () {
        const lines = reader.result.split("\n");
        lines.forEach(line => {
          const [key, value] = line.split("=");
          const input = Array.from(inputs).find(i => i.previousElementSibling && i.previousElementSibling.textContent.toLowerCase().includes(key));
          if (input) {
            input.value = value;
            localStorage.setItem(`eva_${profile}_` + key, value);
          }
        });
      };
      reader.readAsText(file);
    };
    document.querySelector(".settings").appendChild(importBtn);
    document.querySelector(".settings").appendChild(fileInput);

    const saveCloudBtn = document.createElement("button");
    saveCloudBtn.textContent = "‚òÅÔ∏è Save to Cloud";
    saveCloudBtn.className = "feature-button";
    saveCloudBtn.onclick = function () {
      const lines = [];
      inputs.forEach(input => {
        const label = input.previousElementSibling ? input.previousElementSibling.textContent.split(':')[0].toLowerCase() : "";
        lines.push(`${label}=${input.value}`);
      });
      fetch("https://n8n.45dgof8.com/webhook/eva/save-settings", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: `${name}_${profile}`, data: lines.join("\n") })
      }).then(res => res.ok ? alert("‚úÖ Saved to cloud!") : alert("‚ùå Save failed"));
    };
    document.querySelector(".settings").appendChild(saveCloudBtn);

    const loadCloudBtn = document.createElement("button");
    loadCloudBtn.textContent = "‚òÅÔ∏è Load My Settings";
    loadCloudBtn.className = "feature-button";
    loadCloudBtn.onclick = function () {
      fetch(`https://n8n.45dgof8.com/webhook/eva/load-settings?username=${encodeURIComponent(name + '_' + profile)}`)
        .then(res => res.ok ? res.text() : Promise.reject("Not found"))
        .then(text => {
          const lines = text.split("\n");
          lines.forEach(line => {
            const [key, value] = line.split("=");
            const input = Array.from(inputs).find(i => i.previousElementSibling && i.previousElementSibling.textContent.toLowerCase().includes(key));
            if (input) {
              input.value = value;
              localStorage.setItem(`eva_${profile}_` + key, value);
            }
          });
        })
        .catch(() => alert("‚ùå Failed to load profile"));
    };
    document.querySelector(".settings").appendChild(loadCloudBtn);

    const profileInput = document.createElement("input");
    profileInput.placeholder = "Enter profile name (default)";
    profileInput.value = profile;
    profileInput.className = "feature-button";
    profileInput.onchange = function () {
      localStorage.setItem("evaProfile", this.value);
      location.reload();
    };
    document.querySelector(".settings").appendChild(profileInput);

    const shareBtn = document.createElement("button");
    shareBtn.textContent = "üîó Copy Share Link";
    shareBtn.className = "feature-button";
    shareBtn.onclick = function () {
      const url = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(name)}&profile=${encodeURIComponent(profile)}`;
      navigator.clipboard.writeText(url).then(() => alert("üîó Share link copied!"));
    };
    document.querySelector(".settings").appendChild(shareBtn);
  });

  function switchTheme(theme) {
    document.body.className = theme;
    localStorage.setItem("evaTheme", theme)
  }
</script>

</body>
</html>
