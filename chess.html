<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Play Chess with Dion</title>
  <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px;
    }
    #board {
      width: 400px;
      margin-top: 20px;
    }
    #chat {
      background: #1e293b;
      padding: 15px;
      border-radius: 12px;
      width: 400px;
      margin-top: 20px;
      min-height: 100px;
      font-size: 0.95em;
    }
  </style>
</head>
<body>
  <h1>‚ôüÔ∏è Play Chess with Dion</h1>
  <div id="board"></div>
  <div id="chat">Flipping coin to decide who goes first...</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
  <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stockfish@16/stockfish.min.js"></script>
  <script>
    const game = new Chess();
    const engine = STOCKFISH();
    const chatBox = document.getElementById('chat');

    let playerColor = Math.random() < 0.5 ? 'white' : 'black';
    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      orientation: playerColor,
      onDrop: onDrop
    });

    chatBox.innerText = playerColor === 'white'
      ? "Dion: You won the toss! Your move, white wizard."
      : "Dion: I go first‚Äîlet the hunt begin! üê∫";
if (playerColor === 'black') {
  setTimeout(() => {
    board.position('start', false); // ensure synced
    makeEngineMove();
  }, 500);
}

    engine.onmessage = function (event) {
      const line = typeof event === 'object' ? event.data : event;
      if (line.startsWith('bestmove')) {
        const move = line.split(' ')[1];
        game.move({ from: move.substr(0, 2), to: move.substr(2, 2) });
        board.position(game.fen());
        dionSays(move);
      }
    };

    function onDrop(source, target) {
      if (game.turn() !== playerColor[0]) return 'snapback';
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (!move) return 'snapback';
      board.position(game.fen());
      window.setTimeout(makeEngineMove, 250);
    }

    function makeEngineMove() {
      engine.postMessage('position fen ' + game.fen());
      engine.postMessage('go depth 15');
    }

    function dionSays(move) {
      const lines = [
        `Oof! That move? Bold. I respect it.`,
        `Alright, I'm warming up... your turn!`,
        `Check your corners, this wolf plays sharp.`,
        `That last move? Chef‚Äôs kiss.`,
        `You sure you‚Äôre not a grandmaster in disguise?`,
        `Hmm, interesting... let's dance.`
      ];
      const text = lines[Math.floor(Math.random() * lines.length)];
      chatBox.innerText = `Dion: ${text}`;
    }
  </script>
</body>
</html>
